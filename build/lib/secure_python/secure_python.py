import json
import random
from importlib import resources
# Alle Zeichen, die im Python-Code vorkommen kÃ¶nnen (inkl. Zeilenumbruch und Tab)
z = (
    [chr(i) for i in range(32, 127)]  # Standard-ASCII-Zeichen
    + ['\n', '\t', 'Ã¼', 'Ã¤', 'Ã¶', 'ÃŸ']                    # Zeilenumbruch und Tab
)

# Keilschriftzeichen (mindestens so viele wie Zeichen!)
k = list("ğ’€€ğ’€ğ’€‚ğ’€ƒğ’€„ğ’€…ğ’€†ğ’€‡ğ’€ˆğ’€‰ğ’€Šğ’€‹ğ’€Œğ’€ğ’€ğ’€ğ’€ğ’€‘ğ’€’ğ’€“ğ’€”ğ’€•ğ’€–ğ’€—ğ’€˜ğ’€™ğ’€šğ’€›ğ’€œğ’€ğ’€ğ’€Ÿğ’€ ğ’€¡ğ’€¢ğ’€£ğ’€¤ğ’€¥ğ’€¦ğ’€§ğ’€¨ğ’€©ğ’€ªğ’€«ğ’€¬ğ’€­ğ’€®ğ’€¯ğ’€°ğ’€±ğ’€²ğ’€³ğ’€´ğ’€µğ’€¶ğ’€·ğ’€¸ğ’€¹ğ’€ºğ’€»ğ’€¼ğ’€½ğ’€¾ğ’€¿ğ’€ğ’ğ’‚ğ’ƒğ’„ğ’…ğ’†ğ’‡ğ’ˆğ’‰ğ’Šğ’‹ğ’Œğ’ğ’ğ’ğ’ğ’‘ğ’’ğ’“ğ’”ğ’•ğ’–ğ’—ğ’˜ğ’™ğ’šğ’›ğ’œğ’ğ’ğ’Ÿğ’ ğ’¡ğ’¢ğ’£ğ’¤ğ’¥ğ’¦ğ’§ğ’¨ğ’©ğ’ªğ’«ğ’¬ğ’­ğ’®ğ’¯ğ’°ğ’±ğ’²ğ’³ğ’´ğ’µğ’¶ğ’·ğ’¸ğ’¹ğ’ºğ’»ğ’¼ğ’½ğ’¾ğ’¿ğ’‚€ğ’‚ğ’‚‚ğ’‚ƒğ’‚„ğ’‚…ğ’‚†ğ’‚‡ğ’‚ˆğ’‚‰ğ’‚Šğ’‚‹ğ’‚Œğ’‚ğ’‚ğ’‚ğ’‚ğ’‚‘ğ’‚’ğ’‚“ğ’‚”ğ’‚•ğ’‚–ğ’‚—ğ’‚˜ğ’‚™ğ’‚šğ’‚›ğ’‚œğ’‚ğ’‚ğ’‚Ÿğ’‚ ğ’‚¡ğ’‚¢ğ’‚£ğ’‚¤ğ’‚¥ğ’‚¦ğ’‚§ğ’‚¨ğ’‚©ğ’‚ªğ’‚«ğ’‚¬ğ’‚­ğ’‚®ğ’‚¯ğ’‚°ğ’‚±ğ’‚²ğ’‚³ğ’‚´ğ’‚µğ’‚¶ğ’‚·ğ’‚¸ğ’‚¹ğ’‚ºğ’‚»ğ’‚¼ğ’‚½ğ’‚¾ğ’‚¿ğ’ƒ€ğ’ƒğ’ƒ‚ğ’ƒƒğ’ƒ„ğ’ƒ…ğ’ƒ†ğ’ƒ‡ğ’ƒˆğ’ƒ‰ğ’ƒŠğ’ƒ‹ğ’ƒŒğ’ƒğ’ƒğ’ƒğ’ƒğ’ƒ‘ğ’ƒ’ğ’ƒ“ğ’ƒ”ğ’ƒ•ğ’ƒ–ğ’ƒ—ğ’ƒ˜ğ’ƒ™ğ’ƒšğ’ƒ›ğ’ƒœğ’ƒğ’ƒğ’ƒŸğ’ƒ ğ’ƒ¡ğ’ƒ¢ğ’ƒ£ğ’ƒ¤ğ’ƒ¥ğ’ƒ¦ğ’ƒ§ğ’ƒ¨ğ’ƒ©ğ’ƒªğ’ƒ«ğ’ƒ¬ğ’ƒ­ğ’ƒ®ğ’ƒ¯ğ’ƒ°ğ’ƒ±ğ’ƒ²ğ’ƒ³ğ’ƒ´ğ’ƒµğ’ƒ¶ğ’ƒ·ğ’ƒ¸ğ’ƒ¹ğ’ƒºğ’ƒ»ğ’ƒ¼ğ’ƒ½ğ’ƒ¾ğ’ƒ¿ğ’„€ğ’„ğ’„‚ğ’„ƒğ’„„ğ’„…ğ’„†ğ’„‡ğ’„ˆğ’„‰ğ’„Šğ’„‹ğ’„Œğ’„ğ’„ğ’„ğ’„ğ’„‘ğ’„’ğ’„“ğ’„”ğ’„•ğ’„–ğ’„—ğ’„˜ğ’„™ğ’„šğ’„›ğ’„œğ’„ğ’„ğ’„Ÿğ’„ ğ’„¡ğ’„¢ğ’„£ğ’„¤ğ’„¥ğ’„¦ğ’„§ğ’„¨ğ’„©ğ’„ªğ’„«ğ’„¬ğ’„­ğ’„®ğ’„¯ğ’„°ğ’„±ğ’„²ğ’„³ğ’„´ğ’„µğ’„¶ğ’„·ğ’„¸ğ’„¹ğ’„ºğ’„»ğ’„¼ğ’„½ğ’„¾ğ’„¿ğ’…€ğ’…ğ’…‚ğ’…ƒğ’…„ğ’……ğ’…†ğ’…‡ğ’…ˆğ’…‰ğ’…Šğ’…‹ğ’…Œğ’…ğ’…ğ’…ğ’…ğ’…‘ğ’…’ğ’…“ğ’…”ğ’…•ğ’…–ğ’…—ğ’…˜ğ’…™ğ’…šğ’…›ğ’…œğ’…ğ’…ğ’…Ÿğ’… ğ’…¡ğ’…¢ğ’…£ğ’…¤ğ’…¥ğ’…¦ğ’…§ğ’…¨ğ’…©ğ’…ªğ’…«ğ’…¬ğ’…­ğ’…®ğ’…¯ğ’…°ğ’…±ğ’…²ğ’…³ğ’…´ğ’…µğ’…¶ğ’…·ğ’…¸ğ’…¹ğ’…ºğ’…»ğ’…¼ğ’…½ğ’…¾ğ’…¿ğ’†€ğ’†ğ’†‚ğ’†ƒğ’†„ğ’†…ğ’††ğ’†‡ğ’†ˆğ’†‰ğ’†Šğ’†‹ğ’†Œğ’†ğ’†ğ’†ğ’†ğ’†‘ğ’†’ğ’†“ğ’†”ğ’†•ğ’†–ğ’†—ğ’†˜ğ’†™ğ’†šğ’†›ğ’†œğ’†ğ’†ğ’†Ÿğ’† ğ’†¡ğ’†¢ğ’†£ğ’†¤ğ’†¥ğ’†¦ğ’†§ğ’†¨ğ’†©ğ’†ªğ’†«ğ’†¬ğ’†­ğ’†®ğ’†¯ğ’†°ğ’†±ğ’†²ğ’†³ğ’†´ğ’†µğ’†¶ğ’†·ğ’†¸ğ’†¹ğ’†ºğ’†»ğ’†¼ğ’†½ğ’†¾ğ’†¿ğ’‡€ğ’‡ğ’‡‚ğ’‡ƒğ’‡„ğ’‡…ğ’‡†ğ’‡‡ğ’‡ˆğ’‡‰ğ’‡Šğ’‡‹ğ’‡Œğ’‡ğ’‡ğ’‡ğ’‡ğ’‡‘ğ’‡’ğ’‡“ğ’‡”ğ’‡•ğ’‡–ğ’‡—ğ’‡˜ğ’‡™ğ’‡šğ’‡›ğ’‡œğ’‡ğ’‡ğ’‡Ÿğ’‡ ğ’‡¡ğ’‡¢ğ’‡£ğ’‡¤ğ’‡¥ğ’‡¦ğ’‡§ğ’‡¨ğ’‡©ğ’‡ªğ’‡«ğ’‡¬ğ’‡­ğ’‡®ğ’‡¯ğ’‡°ğ’‡±ğ’‡²ğ’‡³ğ’‡´ğ’‡µğ’‡¶ğ’‡·ğ’‡¸ğ’‡¹ğ’‡ºğ’‡»ğ’‡¼ğ’‡½ğ’‡¾ğ’‡¿ğ’ˆ€ğ’ˆğ’ˆ‚ğ’ˆƒğ’ˆ„ğ’ˆ…ğ’ˆ†ğ’ˆ‡ğ’ˆˆğ’ˆ‰ğ’ˆŠğ’ˆ‹ğ’ˆŒğ’ˆğ’ˆğ’ˆğ’ˆğ’ˆ‘ğ’ˆ’ğ’ˆ“ğ’ˆ”ğ’ˆ•ğ’ˆ–ğ’ˆ—ğ’ˆ˜ğ’ˆ™ğ’ˆšğ’ˆ›ğ’ˆœğ’ˆğ’ˆğ’ˆŸğ’ˆ ğ’ˆ¡ğ’ˆ¢ğ’ˆ£ğ’ˆ¤ğ’ˆ¥ğ’ˆ¦ğ’ˆ§ğ’ˆ¨ğ’ˆ©ğ’ˆªğ’ˆ«ğ’ˆ¬ğ’ˆ­ğ’ˆ®ğ’ˆ¯ğ’ˆ°ğ’ˆ±ğ’ˆ²ğ’ˆ³ğ’ˆ´ğ’ˆµğ’ˆ¶ğ’ˆ·ğ’ˆ¸ğ’ˆ¹ğ’ˆºğ’ˆ»ğ’ˆ¼ğ’ˆ½ğ’ˆ¾ğ’ˆ¿ğ’‰€ğ’‰ğ’‰‚ğ’‰ƒğ’‰„ğ’‰…ğ’‰†ğ’‰‡ğ’‰ˆğ’‰‰ğ’‰Šğ’‰‹ğ’‰Œğ’‰ğ’‰ğ’‰ğ’‰ğ’‰‘ğ’‰’ğ’‰“ğ’‰”ğ’‰•ğ’‰–ğ’‰—ğ’‰˜ğ’‰™ğ’‰šğ’‰›ğ’‰œğ’‰ğ’‰ğ’‰Ÿğ’‰ ğ’‰¡ğ’‰¢ğ’‰£ğ’‰¤ğ’‰¥ğ’‰¦ğ’‰§ğ’‰¨ğ’‰©ğ’‰ªğ’‰«ğ’‰¬ğ’‰­ğ’‰®ğ’‰¯ğ’‰°ğ’‰±ğ’‰²ğ’‰³ğ’‰´ğ’‰µğ’‰¶ğ’‰·ğ’‰¸ğ’‰¹ğ’‰ºğ’‰»ğ’‰¼ğ’‰½ğ’‰¾ğ’‰¿ğ’Š€ğ’Šğ’Š‚ğ’Šƒğ’Š„ğ’Š…ğ’Š†ğ’Š‡ğ’Šˆğ’Š‰ğ’ŠŠğ’Š‹ğ’ŠŒğ’Šğ’Šğ’Šğ’Šğ’Š‘ğ’Š’ğ’Š“ğ’Š”ğ’Š•ğ’Š–ğ’Š—ğ’Š˜ğ’Š™ğ’Ššğ’Š›ğ’Šœğ’Šğ’Šğ’ŠŸğ’Š ğ’Š¡ğ’Š¢ğ’Š£ğ’Š¤ğ’Š¥ğ’Š¦ğ’Š§ğ’Š¨ğ’Š©ğ’Šªğ’Š«ğ’Š¬ğ’Š­ğ’Š®ğ’Š¯ğ’Š°ğ’Š±ğ’Š²ğ’Š³ğ’Š´ğ’Šµğ’Š¶ğ’Š·ğ’Š¸ğ’Š¹ğ’Šºğ’Š»ğ’Š¼ğ’Š½ğ’Š¾ğ’Š¿ğ’‹€ğ’‹ğ’‹‚ğ’‹ƒğ’‹„ğ’‹…ğ’‹†ğ’‹‡ğ’‹ˆğ’‹‰ğ’‹Šğ’‹‹ğ’‹Œğ’‹ğ’‹ğ’‹ğ’‹ğ’‹‘ğ’‹’ğ’‹“ğ’‹”ğ’‹•ğ’‹–ğ’‹—ğ’‹˜ğ’‹™ğ’‹šğ’‹›ğ’‹œğ’‹ğ’‹ğ’‹Ÿğ’‹ ğ’‹¡ğ’‹¢ğ’‹£ğ’‹¤ğ’‹¥ğ’‹¦ğ’‹§ğ’‹¨ğ’‹©ğ’‹ªğ’‹«ğ’‹¬ğ’‹­ğ’‹®ğ’‹¯ğ’‹°ğ’‹±ğ’‹²ğ’‹³ğ’‹´ğ’‹µğ’‹¶ğ’‹·ğ’‹¸ğ’‹¹ğ’‹ºğ’‹»ğ’‹¼ğ’‹½ğ’‹¾ğ’‹¿ğ’Œ€ğ’Œğ’Œ‚ğ’Œƒğ’Œ„ğ’Œ…ğ’Œ†ğ’Œ‡ğ’Œˆğ’Œ‰ğ’ŒŠğ’Œ‹ğ’ŒŒğ’Œğ’Œğ’Œğ’Œğ’Œ‘ğ’Œ’ğ’Œ“ğ’Œ”ğ’Œ•ğ’Œ–ğ’Œ—ğ’Œ˜ğ’Œ™ğ’Œšğ’Œ›ğ’Œœğ’Œğ’Œğ’ŒŸğ’Œ ğ’Œ¡ğ’Œ¢ğ’Œ£ğ’Œ¤ğ’Œ¥ğ’Œ¦ğ’Œ§ğ’Œ¨ğ’Œ©ğ’Œªğ’Œ«ğ’Œ¬ğ’Œ­ğ’Œ®ğ’Œ¯ğ’Œ°ğ’Œ±ğ’Œ²ğ’Œ³ğ’Œ´ğ’Œµğ’Œ¶ğ’Œ·ğ’Œ¸ğ’Œ¹ğ’Œºğ’Œ»ğ’Œ¼ğ’Œ½ğ’Œ¾ğ’Œ¿ğ’€ğ’ğ’‚ğ’ƒğ’„ğ’…ğ’†ğ’‡ğ’ˆğ’‰ğ’Šğ’‹ğ’Œğ’ğ’ğ’ğ’ğ’‘ğ’’ğ’“ğ’”ğ’•ğ’–ğ’—ğ’˜ğ’™ğ’šğ’›ğ’œğ’ğ’ğ’Ÿğ’ ğ’¡ğ’¢ğ’£ğ’¤ğ’¥ğ’¦ğ’§ğ’¨ğ’©ğ’ªğ’«ğ’¬ğ’­ğ’®ğ’¯ğ’°ğ’±ğ’²ğ’³ğ’´ğ’µğ’¶ğ’·ğ’¸ğ’¹ğ’ºğ’»ğ’¼ğ’½ğ’¾ğ’¿ğ’€ğ’ğ’‚ğ’ƒğ’„ğ’…ğ’†ğ’‡ğ’ˆğ’‰ğ’Šğ’‹ğ’Œğ’ğ’ğ’ğ’ğ’‘ğ’’ğ’“ğ’”ğ’•ğ’–ğ’—ğ’˜ğ’™")

def z2k(s):  # Zeichen zu Keilschrift
    return ''.join(k[z.index(c)] if c in z else '?' for c in s)

def k2z(s):  # Keilschrift zu Zeichen
    return ''.join(z[k.index(c)] if c in k else '?' for c in s)

def crm():  # Create random mapping
    shuffled = k[:]
    random.shuffle(shuffled)
    return {z[i]: shuffled[i] for i in range(len(z))}

def secure_pfad():
    path_str = str(resources.files("secure_python.secure"))
    if path_str.startswith("MultiplexedPath('") and path_str.endswith("')"):
        path_str = path_str[16:-2]
    return path_str

def sm(mapping, file):  # Save mapping
    verschleiert = {z2k(k): v for k, v in mapping.items()}
    filepath = secure_pfad() + file.removesuffix(".py") + ".lpip.json"
    print(filepath)
    with open(filepath, "w", encoding="utf-8") as f:
        json.dump(verschleiert, f, ensure_ascii=False)

def lm(file):  # Load mapping
    filepath = secure_pfad() + file.removesuffix(".py") + ".lpip.json"
    with open(filepath, "r", encoding="utf-8") as f:
        verschleiert = json.load(f)
    mapping = {k2z(k): v for k, v in verschleiert.items()}
    return mapping

def et(text, mapping):  # Encode text
    return ''.join(mapping.get(c, '?') for c in text)

def dt(text, mapping):  # Decode text
    reverse = {v: k for k, v in mapping.items()}
    return ''.join(reverse.get(c, '?') for c in text)



def ef(file, mapping): #encode file
    
    with open(file, "r", encoding="utf-8") as f:
        code = f.read()
    encoded = et(code, mapping)
    out_file = secure_pfad() + "\\data\\" + file.removesuffix(".py") + ".lpip"
    with open(out_file, "w", encoding="utf-8") as f:
        f.write(encoded)


def oef(file): #open encoded file
    file = secure_pfad() + "\\data\\" + file.removesuffix(".py") + ".lpip"
    with open(file, "r", encoding="utf-8") as f:
        encoded_code = f.read()
    return encoded_code


def df(file): #decode file
    file = secure_pfad() + file.removesuffix(".py") + ".lpip.json"
    mapping = file
    opened_file = oef(file)
    out_file = "\\data\\" + file
    decoded = dt(opened_file, mapping)
    with open(out_file, "w", encoding="utf-8") as f:
        f.write(decoded)

def dfts(file, mapping): #decode file to string
    opened_file = oef(file)
    decoded = dt(opened_file, mapping)
    return decoded